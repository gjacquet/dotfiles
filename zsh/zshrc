# Enable fancy command prompts
setopt prompt_subst

# Enable VI mode line editing 
bindkey -v

# GPG agent configuration
if [ "$(uname -s)" = "Darwin" ]; then
	source ~/.gpg-agent-info
elif [ -S "$XDG_RUNTIME_DIR/gnupg/S.gpg-agent.ssh" ]; then
	export SSH_AUTH_SOCK="$XDG_RUNTIME_DIR/gnupg/S.gpg-agent.ssh"
fi

# Use neo vim as the prefered editor
export EDITOR=nvim
alias vi=nvim
alias vim=nvim

# Do not keep command starting with a space in history
setopt histignorespace

# Key bindings
bindkey "${terminfo[khome]}" beginning-of-line
bindkey "${terminfo[kend]}" end-of-line
bindkey '^R' history-incremental-pattern-search-backward

# Reduce to 0.1s to take into account space key
export KEYTIMEOUT=1

# Go setup
export GOPATH=$HOME/go

# Path
path+=($GOPATH/bin $GOROOT/bin $HOME/bin)

# Snap
if [ -d /snap/bin ]; then
  path+=/snap/bin
fi

# Terraform
if [ -d $HOME/.tfenv/bin ]; then
    path+=$HOME/.tfenv/bin
fi

# ZSH local variables
if [ -f $HOME/.zshlocal ]; then
  source $HOME/.zshlocal
fi

# Use hub as a git alias if installed
if [ -x "$(which hub)" ]; then
	alias git=hub
fi


# Enable completion
autoload -Uz compinit
compinit
zstyle ':completion:*' menu select

# Load antigen
if [ -f "$HOME/share/antigen/antigen.zsh" ]; then
	source "$HOME/share/antigen/antigen.zsh"
elif [ -f /usr/local/share/antigen/antigen.zsh ]; then
	source /usr/local/share/antigen/antigen.zsh
elif [ -f /usr/share/zsh-antigen/antigen.zsh ]; then
	source /usr/share/zsh-antigen/antigen.zsh
fi

antigen use oh-my-zsh

antigen theme bhilburn/powerlevel9k
# Theme configuration
#export ALIEN_THEME="red"
POWERLEVEL9K_MODE='nerdfont-complete'
POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(dir vcs kubecontext newline vi_mode context)
POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(status root_indicator background_jobs time battery)
POWERLEVEL9K_KUBECONTEXT_BACKGROUND=021
POWERLEVEL9K_VI_INSERT_MODE_STRING="I"
POWERLEVEL9K_VI_COMMAND_MODE_STRING="N"
POWERLEVEL9K_SHORTEN_DIR_LENGTH=5

antigen bundle vi-mode
antigen bundle kubectl
antigen bundle golang
antigen bundle terraform
antigen bundle vault
antigen bundle consul
antigen bundle docker
antigen bundle git
antigen bundle screen

antigen bundle zsh-users/zsh-completions
antigen bundle zsh-users/zsh-syntax-highlighting
antigen bundle zsh-users/zsh-history-substring-search
antigen bundle zsh-users/zsh-autosuggestions

if [ $commands[brew] ]; then
	antigen bundle brew
fi

antigen apply


# RVM
if [ -f $HOME/.rvm/scripts/rvm ]; then
  source $HOME/.rvm/scripts/rvm
fi

# SDK man
if [ -d "$HOME/.sdkman" ]; then
	export SDKMAN_DIR="$HOME/.sdkman"
	if [ -s "$SDKMAN_DIR/bin/sdkman-init.sh" ]; then
		source "$SDKMAN_DIR/bin/sdkman-init.sh"
	fi
fi
