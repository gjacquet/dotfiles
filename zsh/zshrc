# Enable fancy command prompts
setopt prompt_subst

# Enable VI mode line editing 
bindkey -v

# GPG agent configuration
if [ "$(uname -s)" = "Darwin" ]; then
	source ~/.gpg-agent-info
elif [ -S "$XDG_RUNTIME_DIR/gnupg/S.gpg-agent.ssh" ]; then
	export SSH_AUTH_SOCK="$XDG_RUNTIME_DIR/gnupg/S.gpg-agent.ssh"
fi

# Use neo vim as the prefered editor
export EDITOR=nvim
alias vi=nvim
alias vim=nvim

# Key bindings
bindkey "${terminfo[khome]}" beginning-of-line
bindkey "${terminfo[kend]}" end-of-line
bindkey '^R' history-incremental-pattern-search-backward
bindkey '^[[A' history-substring-search-up
bindkey '^[[B' history-substring-search-down
bindkey -M emacs '^P' history-substring-search-up
bindkey -M emacs '^N' history-substring-search-down
bindkey -M vicmd 'k' history-substring-search-up
bindkey -M vicmd 'j' history-substring-search-down

# Reduce to 0.1s to take into account space key
export KEYTIMEOUT=1

# Go setup
export GOPATH=$HOME/go

# Path
path+=($GOPATH/bin $GOROOT/bin $HOME/bin)

# Snap
if [ -d /snap/bin ]; then
  path+=/snap/bin
fi

# Terraform
if [ -d $HOME/.tfenv/bin ]; then
    path+=$HOME/.tfenv/bin
fi

# ZSH local variables
if [ -f $HOME/.zshlocal ]; then
  source $HOME/.zshlocal
fi

# Use hub as a git alias if installed
if [ -x "$(which hub)" ]; then
	alias git=hub
fi


# Enable completion
autoload -Uz compinit
compinit
zstyle ':completion:*' menu select

# Theme configuration
POWERLEVEL9K_MODE='nerdfont-complete'
POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(dir vcs kubecontext newline vi_mode context)
POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(status root_indicator background_jobs time battery)
POWERLEVEL9K_KUBECONTEXT_BACKGROUND=021
POWERLEVEL9K_VI_INSERT_MODE_STRING="I"
POWERLEVEL9K_VI_COMMAND_MODE_STRING="N"
POWERLEVEL9K_SHORTEN_DIR_LENGTH=5

# Load zplug
source ~/.zplug/init.zsh

zplug 'zplug/zplug', hook-build:'zplug --self-manage'

zplug "bhilburn/powerlevel9k", as:theme

zplug "lib/history",   from:oh-my-zsh

zplug "plugins/history",   from:oh-my-zsh
zplug "plugins/vi-mode",   from:oh-my-zsh
zplug "plugins/kubectl",   from:oh-my-zsh
zplug "plugins/golang",    from:oh-my-zsh
zplug "plugins/terraform", from:oh-my-zsh
zplug "plugins/vault",     from:oh-my-zsh
zplug "plugins/consul",    from:oh-my-zsh
zplug "plugins/docker",    from:oh-my-zsh
zplug "plugins/git",       from:oh-my-zsh
zplug "plugins/github",    from:oh-my-zsh
zplug "plugins/screen",    from:oh-my-zsh
zplug "plugins/brew",      from:oh-my-zsh, if:"[[ $OSTYPE == *darwin* ]]"

zplug "zsh-users/zsh-completions"
zplug "zsh-users/zsh-syntax-highlighting"
zplug "zsh-users/zsh-history-substring-search"
zplug "zsh-users/zsh-autosuggestions"

if ! zplug check; then
    zplug install
fi
zplug load

# RVM
if [ -f $HOME/.rvm/scripts/rvm ]; then
  source $HOME/.rvm/scripts/rvm
fi

# SDK man
if [ -d "$HOME/.sdkman" ]; then
	export SDKMAN_DIR="$HOME/.sdkman"
	if [ -s "$SDKMAN_DIR/bin/sdkman-init.sh" ]; then
		source "$SDKMAN_DIR/bin/sdkman-init.sh"
	fi
fi
